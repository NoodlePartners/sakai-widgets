<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd" >
 
<head>
    <title><wicket:message key="app.title" /></title>
    <script language="javascript">
    $(document).ready(function () {
        attachPopups($('td.my-connections-cell a'));
    });
    
    /**
     * (Cloned here from profile.attachPopups from v12. Can be removed when v12 is out.)
     * Takes a jQuery array of the elements you want to attach a profile popup to. Each element must
     * have a data attribute with the user's user UUID.
     * @param jqArray An array of jQuery objects.
     */
    attachPopups = function (jqArray) {
    
        if (!(jqArray instanceof jQuery)) {
            console.log('profile.attachPopups takes a jQuery object array, from a selector');
            return;
        }
    
        jqArray.each(function () {
    
            var userId = this.dataset.userId;
    
            $(this).qtip({
                position: { viewport: $(window), adjust: { method: 'flipinvert none'} },
                show: { event: 'click', delay: 0 },
                style: { classes: 'profile-popup-qtip qtip-shadow' },
                hide: { event: 'click unfocus' },
                content: {
                    text: function (event, api) {
    
                        return $.ajax( { url: "/direct/portal/" + userId + "/formatted", cache: false })
                            .then(function (html) {
                                    return html;
                                }, function (xhr, status, error) {
                                    api.set('content.text', status + ': ' + error);
                                });
                    }
                }
            });
        });
    };

    </script>

</head>     
<body>

<wicket:enclosure>
    <div wicket:id="connections"></div>
</wicket:enclosure>

</body>
</html>
